<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script>
        const CELL_SIZE = 5;

        $(document).ready(function () {

            function makePixelMap(context, row, col) {
                console.log(`row=${row}, col=${col}`);
                const r = parseInt(row / CELL_SIZE);
                const c = parseInt(col / CELL_SIZE);
                let map = createArray(r);
                for (let i = 0; i < r; i++) {
                    for (let j = 0; j < c; j++) {
                        const p = context.getImageData(i * CELL_SIZE, j * CELL_SIZE, 1, 1).data;
                        if (p && p[0] < 50 && p[1] < 50 && p[2] < 50) {
                            map[i][j] = 1;
                        }
                    }
                }
                return map;
            }

            function createArray(row) {
                const cells = [[]];
                for (let i = 0; i < row; i++) {
                    cells[i] = [];
                }
                return cells;
            }

            function clearCanvas(cxt, canvasWidth, canvasHeight) {
                cxt.clearRect(0, 0, canvasWidth, canvasHeight);
                cxt.fillStyle = "#eee";
                cxt.fillRect(0, 0, canvasWidth, canvasHeight);
            }

            let mousePress = false;
            const originalCanvas = $("#original");
            const originalContext = originalCanvas.get(0).getContext("2d");
            const copyCanvas = $("#copy");
            const copyContext = copyCanvas.get(0).getContext("2d");
            clearCanvas(originalContext, originalCanvas.width(), originalCanvas.height());
            clearCanvas(copyContext, copyCanvas.width(), copyCanvas.height());

            $(originalCanvas).mousedown(function (e) {
                mousePress = true;
            });

            $(originalCanvas).mouseup(function (e) {
                mousePress = false;
            });

            $(originalCanvas).mousemove(function (e) {
                if (mousePress) {
                    originalContext.fillStyle = "#000";
                    originalContext.fillRect(e.pageX, e.pageY, CELL_SIZE, CELL_SIZE);
                }
            });

            $("#clearButton").click(function (e) {
                clearCanvas(originalContext, originalCanvas.width(), originalCanvas.height());
                clearCanvas(copyContext, copyCanvas.width(), copyCanvas.height());
            });

            $("#copyButton").click(function (e) {
                const canvasWidth = originalCanvas.width();
                const canvasHeight = originalCanvas.height();
                const map = makePixelMap(originalContext, canvasWidth, canvasHeight);
                console.log(map);

                clearCanvas(copyContext, canvasWidth, canvasHeight);
                copyContext.fillStyle = "#000";
                for (let m = 0; m < parseInt(canvasWidth / CELL_SIZE); m++) {
                    for (let n = 0; n < parseInt(canvasHeight / CELL_SIZE); n++) {
                        if (map[m][n]) {
                            copyContext.fillRect(m * CELL_SIZE, n * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                        }
                    }
                }
            });

        });
    </script>
</head>

<body>

<canvas id="original" width="200" height="200"></canvas>
<canvas id="copy" width="200" height="200"></canvas>
<button id="clearButton" name="clearButton" value="Clear">Clear</button>
<button id="copyButton" name="copyButton" value="Copy">Copy</button>

</body>

</html>